<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONVERTITORE+</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
    <h2>CONVERTITORE+</h2>
    <div class="tabs">
        <div class="tab active" data-tab="numeri">Sistemi Numerici</div>
        <div class="tab" data-tab="ipv4">IPv4</div>
        <div class="tab" data-tab="ipv6">IPv6</div>
        <div class="tab" data-tab="classful">Classful</div>
        <div class="tab" data-tab="classless">Classless</div>
        <div class="tab" data-tab="flsm">FLSM</div>
        <div class="tab" data-tab="vlsm">VLSM</div>
        <div class="tab" data-tab="routing">Routing</div>
    </div>

    <div class="tab-content active" id="numeri">
        <h3>Convertitore Base Numerica</h3>
        <input type="text" id="num_val" placeholder="Inserisci numero">
        <select id="num_base">
            <option>Decimale</option>
            <option>Binario</option>
            <option>Ottale</option>
            <option>Esadecimale</option>
        </select>
        <button onclick="convertiNumero()">Converti</button>
        <pre class="result-box" id="num_res"></pre>
    </div>

    <div class="tab-content" id="ipv4">
        <h3>IPv4</h3>
        <input type="text" id="ipv4_val" placeholder="es: 192.168.1.1">
        <select id="ipv4_tipo">
            <option value="dec_to_bin">Decimale → Binario</option>
            <option value="bin_to_dec">Binario → Decimale</option>
        </select>
        <button onclick="convertiIPv4()">Converti</button>
        <pre class="result-box" id="ipv4_res"></pre>
    </div>

    <div class="tab-content" id="ipv6">
        <h3>IPv6</h3>
        <input type="text" id="ipv6_val" placeholder="es: 2001:db8::1">
        <select id="ipv6_tipo">
            <option value="hex_to_bin">Esadecimale → Binario</option>
            <option value="bin_to_hex">Binario → Esadecimale</option>
        </select>
        <button onclick="convertiIPv6()">Converti</button>
        <pre class="result-box" id="ipv6_res"></pre>
    </div>

    <div class="tab-content" id="classful">
        <h3>Analisi Classful</h3>
        <input type="text" id="classful_val" placeholder="es: 192.168.1.1">
        <button onclick="analizzaClassful()">Analizza</button>
        <pre class="result-box" id="classful_res"></pre>
    </div>

    <div class="tab-content" id="classless">
        <h3>Analisi Classless</h3>
        <input type="text" id="classless_val" placeholder="es: 192.168.1.0/24">
        <button onclick="analizzaClassless()">Analizza</button>
        <pre class="result-box" id="classless_res"></pre>
    </div>

    <div class="tab-content" id="flsm">
        <h3>FLSM Subnet Calculator</h3>
        <input type="text" id="flsm_rete" placeholder="Rete base CIDR es: 192.168.1.0/24">
        <input type="number" id="flsm_subnet" placeholder="Numero di subnet">
        <button onclick="calcolaFLSM()">Calcola</button>
        <pre class="result-box" id="flsm_res"></pre>
    </div>


    <div class="tab-content" id="vlsm">
        <h3>VLSM Subnet Calculator</h3>
        <input type="text" id="vlsm_rete" placeholder="Rete base CIDR es: 192.168.10.0/24">
        <div id="vlsm_hosts">
            <input type="text" class="vlsm_host" placeholder="Host richiesti">
        </div>
        <button onclick="aggiungiHost()">Aggiungi Riga</button>
        <button onclick="calcolaVLSM()">Calcola</button>
        <pre class="result-box" id="vlsm_res"></pre>
    </div>
</div>

<div class="tab-content" id="topologia">
    <h3>Topologia di Rete</h3>

    <div id="devices"></div>

    <button onclick="aggiungiDispositivo()">Aggiungi Dispositivo</button>
    <button onclick="calcolaRoutingTopologia()">Calcola Routing</button>

    <pre class="result-box" id="routing_output"></pre>
</div>


<script>
const tabs=document.querySelectorAll(".tab");
tabs.forEach(t=>{
    t.onclick=()=>{
        tabs.forEach(x=>x.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(x=>x.classList.remove("active"));
        t.classList.add("active");
        document.getElementById(t.dataset.tab).classList.add("active");
    };
});

async function convertiNumero(){
    let val=document.getElementById("num_val").value;
    let base=document.getElementById("num_base").value;
    let res=await fetch("/api/converti",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({valore:val,base:base})});
    document.getElementById("num_res").textContent=JSON.stringify(await res.json(),null,2);
}

async function convertiIPv4(){
    let val=document.getElementById("ipv4_val").value;
    let tipo=document.getElementById("ipv4_tipo").value;
    let res=await fetch("/api/ipv4",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({valore:val,tipo:tipo})});
    document.getElementById("ipv4_res").textContent=JSON.stringify(await res.json(),null,2);
}

async function convertiIPv6(){
    let val=document.getElementById("ipv6_val").value;
    let tipo=document.getElementById("ipv6_tipo").value;
    let res=await fetch("/api/ipv6",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({valore:val,tipo:tipo})});
    document.getElementById("ipv6_res").textContent=JSON.stringify(await res.json(),null,2);
}

async function analizzaClassful(){
    let val=document.getElementById("classful_val").value;
    let res=await fetch("/api/classful",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({valore:val})});
    document.getElementById("classful_res").textContent=JSON.stringify(await res.json(),null,2);
}

async function analizzaClassless(){
    let val=document.getElementById("classless_val").value;
    let res=await fetch("/api/classless",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({valore:val})});
    document.getElementById("classless_res").textContent=JSON.stringify(await res.json(),null,2);
}

function aggiungiHost(){
    let div=document.createElement("div");
    div.innerHTML='<input type="text" class="vlsm_host" placeholder="Host richiesti">';
    document.getElementById("vlsm_hosts").appendChild(div);
}

async function calcolaVLSM(){
    let rete=document.getElementById("vlsm_rete").value;
    let hosts=[...document.querySelectorAll(".vlsm_host")].map(x=>parseInt(x.value)||0).filter(x=>x>0);
    let res=await fetch("/api/vlsm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rete:rete,hosts:hosts})});
    document.getElementById("vlsm_res").textContent=JSON.stringify(await res.json(),null,2);
}
    
async function calcolaFLSM(){
    let rete = document.getElementById("flsm_rete").value;
    let subnet = document.getElementById("flsm_subnet").value;
    let res = await fetch("/api/flsm",{method: "POST",headers: {"Content-Type": "application/json"},body: JSON.stringify({rete: rete,subnet: subnet})});
    document.getElementById("flsm_res").textContent=JSON.stringify(await res.json(), null, 2);
}

let deviceCount = 0;

function aggiungiDispositivo(){
    deviceCount++;
    let div = document.createElement("div");
    div.className = "routing_row";
    div.dataset.id = deviceCount;

    div.innerHTML = `
        <input placeholder="Nome" class="dev_nome">
        
        <select class="dev_tipo" onchange="aggiornaCampi(this)">
            <option value="">Tipo</option>
            <option value="PC">PC</option>
            <option value="SWITCH">Switch</option>
            <option value="ROUTER">Router</option>
            <option value="RETE">Rete</option>
        </select>

        <input placeholder="IP / CIDR" class="dev_ip" style="display:none">
        <input placeholder="Collegamenti (nomi separati da ,)" class="dev_link">
    `;

    document.getElementById("devices").appendChild(div);
}

function aggiornaCampi(select){
    let row = select.parentElement;
    let ip = row.querySelector(".dev_ip");

    if(select.value === "ROUTER" || select.value === "PC"){
        ip.style.display = "inline-block";
        ip.placeholder = "IP (es: 192.168.1.1)";
    }
    else if(select.value === "RETE"){
        ip.style.display = "inline-block";
        ip.placeholder = "CIDR (es: 192.168.1.0/24)";
    }
    else{
        ip.style.display = "none";
    }
}

async function calcolaRoutingTopologia(){
    let rows = document.querySelectorAll("#devices .routing_row");
    let dispositivi = [];

    rows.forEach(r=>{
        let nome = r.querySelector(".dev_nome").value.trim();
        let tipo = r.querySelector(".dev_tipo").value;
        let ip = r.querySelector(".dev_ip").value.trim();
        let links = r.querySelector(".dev_link").value
                        .split(",")
                        .map(x=>x.trim())
                        .filter(x=>x);

        if(!nome || !tipo) return;

        let obj = {
            nome: nome,
            tipo: tipo,
            collegamenti: links
        };

        if(tipo === "ROUTER" || tipo === "PC")
            obj.ip = ip;

        if(tipo === "RETE")
            obj.cidr = ip;

        dispositivi.push(obj);
    });

    let res = await fetch("/api/topologia-routing",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({dispositivi: dispositivi})
    });

    document.getElementById("routing_output").textContent =
        JSON.stringify(await res.json(), null, 2);
}

    
</script>
</body>
</html>
